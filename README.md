# TIVAN-Indel

By leveraging labeled Small Insertion and Deletion (sindel) that are highly potential in regulating gene expressions in GTEx, as well as a compilation of both generic functional annotations and tissue-specific functional annotations generated by sequence-based deep learning models, we developed TIVAN-Indel, which is an XGBoost-based supervised framework for scoring noncoding sindels based on their potential to regulate the nearby gene expressions. 

<p align="center"><img src="res/overview.png"/></p>
<p align="center">Figure 1. Overview of the TIVAN-Indel.</p>

## Requirements

TIVAN-Indel uses python `3.9.6` and xgboost `1.5.1`. The other requirements are:

```
h5py==3.1.0
matplotlib==3.4.3
numpy==1.19.3
numpy-utils==0.1.6
pandas==1.4.0
scikit-learn==0.24.2
tensorflow==2.6.0
```

## Usage

Download TIVAN-Indel

```bash
git clone https://github.com/amanbasu/TIVAN-indel.git
```

Install requirements

```bash
pip install -r requirements.txt
```

### DanQ model

The trained weights of DanQ model are provided in the `checkpoint/` directory, while the model code is present in `models/` directory. You can train your own model by using data from DeepSEA website (http://deepsea.princeton.edu/help/).

### Prepare training data

We use a compilation of both generic functional annotations and tissue-specific functional annotations generated by sequence-based deep learning models to train our TIVAN-indel model. The generic functional annotations are stored in `.trainingset.rda` files, which is a table of 45 annotation containing additional columns like 'RawScore' and 'PHRED' which are ignored. The 919 tissue-specific functional annotations are derived from a trained DanQ model. File `read_rda.r` reads the rda file and saves the annotation while `prepare_feature.py` file uses these annotations and combines them with other 919 features to create the input data for TIVAN-indel.

You can learn more about the script arguments using the `-h` command for individual files.

```
$ python prepare_feature.py -h
usage: prepare_feature.py [-h] [--path PATH] [--tissue TISSUE]

Arguments for preparing features.

optional arguments:
  -h, --help       show this help message and exit
  --path PATH      base path for input data
  --tissue TISSUE  tissue name
```

### Train TIVAN-indel model

The model architecture is described in Figure 1 (Part C). It uses a compilation of both generic functional annotations and tissue-specific functional annotations generated by sequence-based DanQ model for prediction. Use the below code to train models on specific tissues.

```bash
python train.py --train_tissue Whole_Blood --folds 5 --save_model True
```

### Predict

The TIVAN-indel model trained in the above section can be used to make predictions on new/unseen tissues. Use the below code to predict on new tissues.

```bash
python predict.py --train_tissue Whole_Blood --test_tissue CD4_NAIVE
```

## Obtain precomputed tissue-specific functional scores for query small indels

### R package installation
Two R packages "GenomicRanges" and "data.table" are required to retrieve tissue-specific functional scores for query small indels.

```r
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install("GenomicRanges")
```

```r
install.packages("data.table")
```

### Data and code preparation

- All noncoding small indels in 1000 Genomes (sindel.noncoding.1kg.rda) can be downloaded from [Here](https://drive.google.com/file/d/1u7PV9JqM1YmllutP56Gv0faP_Yhf1h4_/view?usp=share_link)

- The precomputed scores for All noncoding small indels in 1000 Genomes across 44 tissues/cell types (e.g., Adipose_Subcutaneous.score.rda) in GTEX can be downloaded from [Here](https://drive.google.com/drive/folders/1fZ_V4_2sr-lPCa1HItXoUIvJ40qa_w_h?usp=share_link). The 44 tissues/cell types from GTEX are summarized in the following table.


|Tissue                                |Tissue.class  |
|:-------------------------------------|:-------------|
|Adipose_Subcutaneous                  |Adipose       |
|Adipose_Visceral_Omentum              |Adipose       |
|Adrenal_Gland                         |Adrenal Gland |
|Artery_Aorta                          |Artery        |
|Artery_Coronary                       |Artery        |
|Artery_Tibial                         |Artery        |
|Brain_Anterior_cingulate_cortex_BA24  |Brain         |
|Brain_Caudate_basal_ganglia           |Brain         |
|Brain_Cerebellar_Hemisphere           |Brain         |
|Brain_Cerebellum                      |Brain         |
|Brain_Cortex                          |Brain         |
|Brain_Frontal_Cortex_BA9              |Brain         |
|Brain_Hippocampus                     |Brain         |
|Brain_Hypothalamus                    |Brain         |
|Brain_Nucleus_accumbens_basal_ganglia |Brain         |
|Brain_Putamen_basal_ganglia           |Brain         |
|Breast_Mammary_Tissue                 |Breast        |
|Cells_EBV-transformed_lymphocytes     |Lymphocytes   |
|Cells_Transformed_fibroblasts         |Fibroblasts   |
|Colon_Sigmoid                         |Colon         |
|Colon_Transverse                      |Colon         |
|Esophagus_Gastroesophageal_Junction   |Esophagus     |
|Esophagus_Mucosa                      |Esophagus     |
|Esophagus_Muscularis                  |Esophagus     |
|Heart_Atrial_Appendage                |Heart         |
|Heart_Left_Ventricle                  |Heart         |
|Liver                                 |Liver         |
|Lung                                  |Lung          |
|Muscle_Skeletal                       |Muscle        |
|Nerve_Tibial                          |Nerve         |
|Ovary                                 |Ovary         |
|Pancreas                              |Pancreas      |
|Pituitary                             |Pituitary     |
|Prostate                              |Prostate      |
|Skin_Not_Sun_Exposed_Suprapubic       |Skin          |
|Skin_Sun_Exposed_Lower_leg            |Skin          |
|Small_Intestine_Terminal_Ileum        |Intestine     |
|Spleen                                |Spleen        |
|Stomach                               |Stomach       |
|Testis                                |Testis        |
|Thyroid                               |Thyroid       |
|Uterus                                |Uterus        |
|Vagina                                |Vagina        |
|Whole_Blood                           |Blood         |


- TIVAN-indel.R: R software to retrieve the precomputed scores for query sindels can be downloaded [Here](https://drive.google.com/file/d/14pumyX5GTb-DpKj5lIaSMsQPY9Ixlg9Q/view?usp=share_link)

- region.txt: query regions in the following example can downloaded [Here](https://drive.google.com/file/d/1uqJF0gIePA1nrqOMVGrn0bh3AzukQuJO/view?usp=share_link), such as:


<img width="881" alt="Screen Shot 2022-12-31 at 4 05 17 PM" src="https://user-images.githubusercontent.com/29525389/210155683-13f95a25-415d-47ae-bcc5-30d37b92f139.png">


### Command line arguments
```r 
- Usage: R --slave --args --no-save arg1 arg2 arg3 arg4 < TIVAN-indel.R 

  - arg1: Input region: regionfile of small indels. The file has three columns "chr start end" with space/tab-delimited (chr1 10001 20000)
  - arg2: A file of all known 1000 Genome indels
  - arg3: A file/files of pre-computed score of 1000 Genome indels, multiple files are separated by comma
  - arg4: A output file contains retrieved scores for sindels in query region
```

### Examples


- Example One: Interested in one tissue at a time
```r 
R --slave --args --no-save region.txt sindel.noncoding.1kg.rda Adipose_Subcutaneous.score.rda output.txt  < TIVAN-indel.R
```

- Example Two: Interested in multiple tissues at the same time
```r 
R --slave --args --no-save region.txt sindel.noncoding.1kg.rda Adipose_Subcutaneous.score.rda,Adipose_Visceral_Omentum.score.rda output.txt  < TIVAN-indel.R
```


The expected otuput from Example Two is:

<img width="881" alt="Screen Shot 2022-12-31 at 4 05 17 PM" src="https://user-images.githubusercontent.com/29525389/210155653-b3f622be-af92-4589-8fc1-dea9de285bda.png">









